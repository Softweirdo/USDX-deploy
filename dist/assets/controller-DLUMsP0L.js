const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-CE4f2pNg.js","assets/index-Cm3a0QdF.js","assets/index-CHIcPt2L.css","assets/Staking-GJ2jglti.js","assets/allowance-DasHiDOK.js","assets/TypedData-BUve7p8N.js","assets/Address-DiYf5oiz.js","assets/arweave-CAGvOb64.js"])))=>i.map(i=>d[i]);
import{ak as k,bK as z,a0 as C,$ as J,ad as K,ac as M,aa as B,bL as S,bM as O,ab as R,ae as Y,af as G}from"./index-Cm3a0QdF.js";import{d as X,n as U,e as H,D as Z,h as v,i as ee,N as x,j as ne,t as ae,k as te,v as ie,m as se}from"./Staking-GJ2jglti.js";import{p as re}from"./allowance-DasHiDOK.js";import"./TypedData-BUve7p8N.js";import"./Address-DiYf5oiz.js";import"./arweave-CAGvOb64.js";const ce=e=>e;class oe extends k{constructor({body:a,error:t,url:r}){super("RPC Request failed.",{cause:t,details:t.message,metaMessages:[`URL: ${ce(r)}`,`Request body: ${X(a)}`],name:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=t.code}}const de=-1;class le extends k{constructor(a,{code:t,docsPath:r,metaMessages:i,name:n,shortMessage:s}){super(s,{cause:a,docsPath:r,metaMessages:i||(a==null?void 0:a.metaMessages),name:n||"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=n||a.name,this.code=a instanceof oe?a.code:t??de}}class F extends le{constructor(a,t){super(a,t),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=t.data}}class P extends F{constructor(a){super(a,{code:P.code,name:"UserRejectedRequestError",shortMessage:"User rejected the request."})}}Object.defineProperty(P,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class _ extends F{constructor(a){super(a,{code:_.code,name:"SwitchChainError",shortMessage:"An error occurred when attempting to switch chain."})}}Object.defineProperty(_,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});const L="wallet_addEthereumChain",ue=!0,q={requestedChains:"tw.wc.requestedChains",lastUsedChainId:"tw.wc.lastUsedChainId"};async function Ee(e,a,t,r,i){var T,y;const n=await V(e,t,i),s=e.walletConnect;let{onDisplayUri:o}=s||{};if(!o&&i&&t!=="walletConnect"){const m=await H(t);o=p=>{const b=m.mobile.native||m.mobile.universal;if(!b)throw new Error("No app url found for wallet connect to redirect to.");const I=ne(b,p).redirect;i(I)}}o&&n.events.addListener("display_uri",o);let d=s==null?void 0:s.optionalChains,c=e.chain;t==="global.safe"&&(d=$.map(C),c&&!d.includes(c)&&(c=void 0));const{rpcMap:u,requiredChain:l,optionalChains:h}=Q({client:e.client,chain:c,optionalChains:d});n.session&&await n.connect({...s!=null&&s.pairingTopic?{pairingTopic:s==null?void 0:s.pairingTopic}:{},optionalChains:h,chains:l?[l.id]:void 0,rpcMap:u}),A(h,r);const f=(await n.enable())[0];if(!f)throw new Error("No accounts found on provider.");const g=U(n.chainId),E=e.chain&&e.chain.id===g?e.chain:C(g);if(e){const m={optionalChains:(T=e.walletConnect)==null?void 0:T.optionalChains,chain:e.chain,pairingTopic:(y=e.walletConnect)==null?void 0:y.pairingTopic};r&&O(r,t,m)}return s!=null&&s.onDisplayUri&&n.events.removeListener("display_uri",s.onDisplayUri),W(f,E,n,a,r,e.client)}async function Ie(e,a,t,r,i){const n=r?await z(r,t):null,s=await V(n?{chain:n.chain,client:e.client,walletConnect:{pairingTopic:n.pairingTopic,optionalChains:n.optionalChains}}:{client:e.client,walletConnect:{}},t,i,!0),o=s.accounts[0];if(!o)throw new Error("No accounts found on provider.");const d=U(s.chainId),c=e.chain&&e.chain.id===d?e.chain:C(d);return W(o,c,s,a,r,e.client)}async function V(e,a,t,r=!1){var g,E,T,y;const i=await H(a),n=e.walletConnect,{EthereumProvider:s,OPTIONAL_EVENTS:o,OPTIONAL_METHODS:d}=await J(async()=>{const{EthereumProvider:m,OPTIONAL_EVENTS:w,OPTIONAL_METHODS:p}=await import("./index.es-CE4f2pNg.js");return{EthereumProvider:m,OPTIONAL_EVENTS:w,OPTIONAL_METHODS:p}},__vite__mapDeps([0,1,2,3,4,5,6,7]));let c=n==null?void 0:n.optionalChains,u=e.chain;a==="global.safe"&&(c=$.map(C),u&&!c.includes(u)&&(u=void 0));const{rpcMap:l,requiredChain:h,optionalChains:D}=Q({client:e.client,chain:u,optionalChains:c}),f=await s.init({showQrModal:(n==null?void 0:n.showQrModal)===void 0?t?!1:ue:n.showQrModal,projectId:(n==null?void 0:n.projectId)||Z,optionalMethods:d,optionalEvents:o,optionalChains:D,chains:h?[h.id]:void 0,metadata:{name:((g=n==null?void 0:n.appMetadata)==null?void 0:g.name)||v().name,description:((E=n==null?void 0:n.appMetadata)==null?void 0:E.description)||v().description,url:((T=n==null?void 0:n.appMetadata)==null?void 0:T.url)||v().url,icons:[((y=n==null?void 0:n.appMetadata)==null?void 0:y.logoUrl)||v().logoUrl]},rpcMap:l,qrModalOptions:n==null?void 0:n.qrModalOptions,disableProviderPing:!0});if(f.events.setMaxListeners(Number.POSITIVE_INFINITY),r||f.session&&await f.disconnect(),a!=="walletConnect"){async function m(){var p,b,I,N;const w=((N=(I=(b=(p=f.session)==null?void 0:p.peer)==null?void 0:b.metadata)==null?void 0:I.redirect)==null?void 0:N.native)||i.mobile.native||i.mobile.universal;t&&w&&await t(w)}f.signer.client.on("session_request_sent",m),f.events.addListener("disconnect",()=>{f.signer.client.off("session_request_sent",m)})}return f}function j({provider:e,address:a,client:t}){return{address:a,async sendTransaction(i){const n=await e.request({method:"eth_sendTransaction",params:[{gas:i.gas?M(i.gas):void 0,value:i.value?M(i.value):void 0,from:R(a),to:i.to,data:i.data}]});return ae({client:t,walletAddress:R(a),walletType:"walletConnect",transactionHash:n,chainId:i.chainId,contractAddress:i.to??void 0,gasPrice:i.gasPrice}),{transactionHash:n}},async signMessage({message:i}){const n=typeof i=="string"?Y(i):i.raw instanceof Uint8Array?G(i.raw):i.raw;return e.request({method:"personal_sign",params:[n,this.address]})},async signTypedData(i){const n=re(i),{domain:s,message:o,primaryType:d}=n,c={EIP712Domain:te({domain:s}),...n.types};ie({domain:s,message:o,primaryType:d,types:c});const u=se({domain:s??{},message:o,primaryType:d,types:c});return await e.request({method:"eth_signTypedData_v4",params:[this.address,u]})}}}function W(e,a,t,r,i,n){const s=j({provider:t,address:e,client:n});async function o(){t.removeListener("accountsChanged",c),t.removeListener("chainChanged",u),t.removeListener("disconnect",d),await t.disconnect()}function d(){A([],i),i==null||i.removeItem(q.lastUsedChainId),o(),r.emit("disconnect",void 0)}function c(l){if(l[0]){const h=j({provider:t,address:R(l[0]),client:n});r.emit("accountChanged",h),r.emit("accountsChanged",l)}else d()}function u(l){const h=C(U(l));r.emit("chainChanged",h),i==null||i.setItem(q.lastUsedChainId,String(l))}return t.on("accountsChanged",c),t.on("chainChanged",u),t.on("disconnect",d),t.on("session_delete",d),[s,a,o,l=>me(t,l,i)]}function he(e){var a,t;return((t=(a=e.session)==null?void 0:a.namespaces[x])==null?void 0:t.methods)||[]}function fe(e){var t,r,i;return((i=(r=(t=e.session)==null?void 0:t.namespaces[x])==null?void 0:r.chains)==null?void 0:i.map(n=>Number.parseInt(n.split(":")[1]||"")))??[]}async function me(e,a,t){var i,n;const r=a.id;try{const s=fe(e),o=he(e);if(!s.includes(r)&&o.includes(L)){const c=await K(a),u=[...new Set([...((i=a.blockExplorers)==null?void 0:i.map(h=>h.url))||[],...((n=c.explorers)==null?void 0:n.map(h=>h.url))||[]])];await e.request({method:L,params:[{chainId:M(c.chainId),chainName:c.name,nativeCurrency:c.nativeCurrency,rpcUrls:ee(c),blockExplorerUrls:u.length>0?u:void 0}]});const l=await pe(t);l.push(r),A(l,t)}await e.request({method:"wallet_switchEthereumChain",params:[{chainId:M(r)}]})}catch(s){const o=typeof s=="string"?s:s==null?void 0:s.message;throw/user rejected request/i.test(o)?new P(s):new _(s)}}function A(e,a){a==null||a.setItem(q.requestedChains,B(e))}async function pe(e){const a=await e.getItem(q.requestedChains);return a?JSON.parse(a):[]}function Q(e){const a={};e.chain&&(a[e.chain.id]=S({chain:e.chain,client:e.client}));const t=((e==null?void 0:e.optionalChains)||[]).slice(0,10);for(const r of t)a[r.id]=S({chain:r,client:e.client});return!e.chain&&t.length===0&&(a[1]=C(1).rpc),{rpcMap:a,requiredChain:e.chain?e.chain:void 0,optionalChains:t.length>0?t.map(r=>r.id):[1]}}const $=[1,11155111,42161,43114,8453,1313161554,84532,56,42220,100,10,137,1101,324,534352];export{Ie as autoConnectWC,Ee as connectWC};
