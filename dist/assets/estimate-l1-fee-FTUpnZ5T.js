import{by as u,bH as w,bn as s,bG as N,bC as C,bu as U,bI as J,bE as W,bJ as q,bv as z,bK as b,ay as Q}from"./index-CzTMIYai.js";import{a5 as S,j as X,g as Z}from"./allowance-CN36WWrq.js";import{a as g}from"./Address-Cb4NlrhT.js";const tt={bytes:new Uint8Array,dataView:new DataView(new ArrayBuffer(0)),position:0,positionReadCount:new Map,recursiveReadCount:0,recursiveReadLimit:Number.POSITIVE_INFINITY,assertReadLimit(){if(this.recursiveReadCount>=this.recursiveReadLimit)throw new rt({count:this.recursiveReadCount+1,limit:this.recursiveReadLimit})},assertPosition(t){if(t<0||t>this.bytes.length-1)throw new it({length:this.bytes.length,position:t})},decrementPosition(t){if(t<0)throw new V({offset:t});const e=this.position-t;this.assertPosition(e),this.position=e},getReadCount(t){return this.positionReadCount.get(t||this.position)||0},incrementPosition(t){if(t<0)throw new V({offset:t});const e=this.position+t;this.assertPosition(e),this.position=e},inspectByte(t){const e=t??this.position;return this.assertPosition(e),this.bytes[e]},inspectBytes(t,e){const i=e??this.position;return this.assertPosition(i+t-1),this.bytes.subarray(i,i+t)},inspectUint8(t){const e=t??this.position;return this.assertPosition(e),this.bytes[e]},inspectUint16(t){const e=t??this.position;return this.assertPosition(e+1),this.dataView.getUint16(e)},inspectUint24(t){const e=t??this.position;return this.assertPosition(e+2),(this.dataView.getUint16(e)<<8)+this.dataView.getUint8(e+2)},inspectUint32(t){const e=t??this.position;return this.assertPosition(e+3),this.dataView.getUint32(e)},pushByte(t){this.assertPosition(this.position),this.bytes[this.position]=t,this.position++},pushBytes(t){this.assertPosition(this.position+t.length-1),this.bytes.set(t,this.position),this.position+=t.length},pushUint8(t){this.assertPosition(this.position),this.bytes[this.position]=t,this.position++},pushUint16(t){this.assertPosition(this.position+1),this.dataView.setUint16(this.position,t),this.position+=2},pushUint24(t){this.assertPosition(this.position+2),this.dataView.setUint16(this.position,t>>8),this.dataView.setUint8(this.position+2,t&255),this.position+=3},pushUint32(t){this.assertPosition(this.position+3),this.dataView.setUint32(this.position,t),this.position+=4},readByte(){this.assertReadLimit(),this._touch();const t=this.inspectByte();return this.position++,t},readBytes(t,e){this.assertReadLimit(),this._touch();const i=this.inspectBytes(t);return this.position+=e??t,i},readUint8(){this.assertReadLimit(),this._touch();const t=this.inspectUint8();return this.position+=1,t},readUint16(){this.assertReadLimit(),this._touch();const t=this.inspectUint16();return this.position+=2,t},readUint24(){this.assertReadLimit(),this._touch();const t=this.inspectUint24();return this.position+=3,t},readUint32(){this.assertReadLimit(),this._touch();const t=this.inspectUint32();return this.position+=4,t},get remaining(){return this.bytes.length-this.position},setPosition(t){const e=this.position;return this.assertPosition(t),this.position=t,()=>this.position=e},_touch(){if(this.recursiveReadLimit===Number.POSITIVE_INFINITY)return;const t=this.getReadCount();this.positionReadCount.set(this.position,t+1),t>0&&this.recursiveReadCount++}};function et(t,{recursiveReadLimit:e=8192}={}){const i=Object.create(tt);return i.bytes=t,i.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength),i.positionReadCount=new Map,i.recursiveReadLimit=e,i}class V extends u{constructor({offset:e}){super(`Offset \`${e}\` cannot be negative.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Cursor.NegativeOffsetError"})}}class it extends u{constructor({length:e,position:i}){super(`Position \`${i}\` is out of bounds (\`0 < position < ${e}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Cursor.PositionOutOfBoundsError"})}}class rt extends u{constructor({count:e,limit:i}){super(`Recursive read limit of \`${i}\` exceeded (recursive read count: \`${e}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Cursor.RecursiveReadLimitExceededError"})}}function nt(t,e={}){const{recovered:i}=e;if(typeof t.r>"u")throw new T({signature:t});if(typeof t.s>"u")throw new T({signature:t});if(i&&typeof t.yParity>"u")throw new T({signature:t});if(t.r<0n||t.r>S)throw new ft({value:t.r});if(t.s<0n||t.s>S)throw new ht({value:t.s});if(typeof t.yParity=="number"&&t.yParity!==0&&t.yParity!==1)throw new $({value:t.yParity})}function st(t){return j(N(t))}function j(t){if(t.length!==130&&t.length!==132)throw new ct({signature:t});const e=BigInt(C(t,0,32)),i=BigInt(C(t,32,64)),n=(()=>{const r=+`0x${t.slice(130)}`;if(!Number.isNaN(r))try{return I(r)}catch{throw new $({value:r})}})();return typeof n>"u"?{r:e,s:i}:{r:e,s:i,yParity:n}}function P(t){if(!(typeof t.r>"u")&&!(typeof t.s>"u"))return ot(t)}function ot(t){const e=typeof t=="string"?j(t):t instanceof Uint8Array?st(t):typeof t.r=="string"?at(t):t.v?G(t):{r:t.r,s:t.s,...typeof t.yParity<"u"?{yParity:t.yParity}:{}};return nt(e),e}function G(t){return{r:t.r,s:t.s,yParity:I(t.v)}}function at(t){const e=(()=>{const i=t.v?Number(t.v):void 0;let n=t.yParity?Number(t.yParity):void 0;if(typeof i=="number"&&typeof n!="number"&&(n=I(i)),typeof n!="number")throw new $({value:t.yParity});return n})();return{r:BigInt(t.r),s:BigInt(t.s),yParity:e}}function x(t){const{r:e,s:i,yParity:n}=t;return[n?"0x01":"0x",e===0n?"0x":w(s(e)),i===0n?"0x":w(s(i))]}function I(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new _({value:t})}function ut(t){if(t===0)return 27;if(t===1)return 28;throw new $({value:t})}class ct extends u{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${U(J(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class T extends u{constructor({signature:e}){super(`Signature \`${W(e)}\` is missing either an \`r\`, \`s\`, or \`yParity\` property.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.MissingPropertiesError"})}}class ft extends u{constructor({value:e}){super(`Value \`${e}\` is an invalid r value. r must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidRError"})}}class ht extends u{constructor({value:e}){super(`Value \`${e}\` is an invalid s value. s must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSError"})}}class $ extends u{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class _ extends u{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}function B(t){if(!t||t.length===0)return[];const e=[];for(const{address:i,storageKeys:n}of t){for(let r=0;r<n.length;r++)if(U(n[r])!==32)throw new dt({storageKey:n[r]});i&&g(i,{strict:!1}),e.push([i,n])}return e}class dt extends u{constructor({storageKey:e}){super(`Size for storage key "${e}" is invalid. Expected 32 bytes. Got ${U(e)} bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AccessList.InvalidStorageKeySizeError"})}}function lt(t,e){const{as:i}=e,n=A(t),r=et(new Uint8Array(n.length));return n.encode(r),i==="Hex"?N(r.bytes):r.bytes}function E(t,e={}){const{as:i="Hex"}=e;return lt(t,{as:i})}function A(t){return Array.isArray(t)?pt(t.map(e=>A(e))):yt(t)}function pt(t){const e=t.reduce((r,o)=>r+o.length,0),i=H(e);return{length:e<=55?1+e:1+i+e,encode(r){e<=55?r.pushByte(192+e):(r.pushByte(247+i),i===1?r.pushUint8(e):i===2?r.pushUint16(e):i===3?r.pushUint24(e):r.pushUint32(e));for(const{encode:o}of t)o(r)}}}function yt(t){const e=typeof t=="string"?q(t):t,i=H(e.length);return{length:e.length===1&&e[0]<128?1:e.length<=55?1+e.length:1+i+e.length,encode(r){e.length===1&&e[0]<128?r.pushBytes(e):e.length<=55?(r.pushByte(128+e.length),r.pushBytes(e)):(r.pushByte(183+i),i===1?r.pushUint8(e.length):i===2?r.pushUint16(e.length):i===3?r.pushUint24(e.length):r.pushUint32(e.length),r.pushBytes(e))}}}function H(t){if(t<2**8)return 1;if(t<2**16)return 2;if(t<2**24)return 3;if(t<2**32)return 4;throw new u("Length is too large.")}const F={wei:0,gwei:9,szabo:12,finney:15,ether:18};function bt(t,e=0){let i=t.toString();const n=i.startsWith("-");n&&(i=i.slice(1)),i=i.padStart(e,"0");let[r,o]=[i.slice(0,i.length-e),i.slice(i.length-e)];return o=o.replace(/(0+)$/,""),`${n?"-":""}${r||"0"}${o?`.${o}`:""}`}function v(t,e="wei"){return bt(t,F.gwei-F[e])}class gt extends u{constructor({feeCap:e}={}){super(`The fee cap (\`maxFeePerGas\`/\`maxPriorityFeePerGas\`${e?` = ${v(e)} gwei`:""}) cannot be higher than the maximum allowed value (2^256-1).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TransactionEnvelope.FeeCapTooHighError"})}}class M extends u{constructor({gasPrice:e}={}){super(`The gas price (\`gasPrice\`${e?` = ${v(e)} gwei`:""}) cannot be higher than the maximum allowed value (2^256-1).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TransactionEnvelope.GasPriceTooHighError"})}}class L extends u{constructor({chainId:e}){super(typeof e<"u"?`Chain ID "${e}" is invalid.`:"Chain ID is invalid."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TransactionEnvelope.InvalidChainIdError"})}}class mt extends u{constructor({maxPriorityFeePerGas:e,maxFeePerGas:i}={}){super([`The provided tip (\`maxPriorityFeePerGas\`${e?` = ${v(e)} gwei`:""}) cannot be higher than the fee cap (\`maxFeePerGas\`${i?` = ${v(i)} gwei`:""}).`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TransactionEnvelope.TipAboveFeeCapError"})}}const wt="0x02";function R(t){const{chainId:e,maxPriorityFeePerGas:i,maxFeePerGas:n,to:r}=t;if(e<=0)throw new L({chainId:e});if(r&&g(r,{strict:!1}),n&&BigInt(n)>2n**256n-1n)throw new gt({feeCap:n});if(i&&n&&i>n)throw new mt({maxFeePerGas:n,maxPriorityFeePerGas:i})}function vt(t,e={}){const{chainId:i,gas:n,nonce:r,to:o,value:c,maxFeePerGas:d,maxPriorityFeePerGas:h,accessList:l,data:f,input:a}=t;R(t);const y=B(l),p=P(e.signature||t),m=[s(i),r?s(r):"0x",h?s(h):"0x",d?s(d):"0x",n?s(n):"0x",o??"0x",c?s(c):"0x",f??a??"0x",y,...p?x(p):[]];return z(wt,E(m))}function Y(t){const{chainId:e,gasPrice:i,to:n}=t;if(e<=0)throw new L({chainId:e});if(n&&g(n,{strict:!1}),i&&BigInt(i)>2n**256n-1n)throw new M({gasPrice:i})}function Pt(t,e={}){const{chainId:i,gas:n,data:r,input:o,nonce:c,to:d,value:h,accessList:l,gasPrice:f}=t;Y(t);const a=B(l),y=P(e.signature||t),p=[s(i),c?s(c):"0x",f?s(f):"0x",n?s(n):"0x",d??"0x",h?s(h):"0x",r??o??"0x",a,...y?x(y):[]];return z("0x01",E(p))}function xt(t){const{address:e,chainId:i,nonce:n}=t,r=P(t);return[i?s(i):"0x",e,n?s(n):"0x",...r?x(r):[]]}function It(t){if(!t||t.length===0)return[];const e=[];for(const i of t)e.push(xt(i));return e}const $t="0x04";function D(t){const{authorizationList:e}=t;if(e)for(const i of e){const{address:n,chainId:r}=i;if(n&&g(n,{strict:!1}),Number(r)<0)throw new L({chainId:r})}R(t)}function Et(t,e={}){const{authorizationList:i,chainId:n,gas:r,nonce:o,to:c,value:d,maxFeePerGas:h,maxPriorityFeePerGas:l,accessList:f,data:a,input:y}=t;D(t);const p=B(f),m=It(i),O=P(e.signature||t),k=[s(n),o?s(o):"0x",l?s(l):"0x",h?s(h):"0x",r?s(r):"0x",c??"0x",d?s(d):"0x",a??y??"0x",p,m,...O?x(O):[]];return z($t,E(k))}function K(t){const{chainId:e,gasPrice:i,to:n}=t;if(n&&g(n,{strict:!1}),typeof e<"u"&&e<=0)throw new L({chainId:e});if(i&&BigInt(i)>2n**256n-1n)throw new M({gasPrice:i})}function Lt(t,e={}){const{chainId:i=0,gas:n,data:r,input:o,nonce:c,to:d,value:h,gasPrice:l}=t;K(t);let f=[c?s(c):"0x",l?s(l):"0x",n?s(n):"0x",d??"0x",h?s(h):"0x",r??o??"0x"];const a=(()=>{if(e.signature)return{r:e.signature.r,s:e.signature.s,v:ut(e.signature.yParity)};if(!(typeof t.r>"u"||typeof t.s>"u"))return{r:t.r,s:t.s,v:t.v}})();if(a){const y=(()=>{if(a.v>=35)return Math.floor((a.v-35)/2)>0?a.v:27+(a.v===35?0:1);if(i>0)return i*2+35+a.v-27;const p=27+(a.v===27?0:1);if(a.v!==p)throw new _({value:a.v});return p})();f=[...f,s(y),a.r===0n?"0x":w(s(a.r)),a.s===0n?"0x":w(s(a.s))]}else i>0&&(f=[...f,s(i),"0x","0x"]);return E(f)}function Tt(t){const{transaction:e}=t,i=Ut(e),n=(()=>{if(t.signature)return"v"in t.signature&&typeof t.signature.v<"u"?G({r:b(t.signature.r),s:b(t.signature.s),v:Number(t.signature.v)}):{r:b(t.signature.r),s:b(t.signature.s),yParity:t.signature.yParity};if(!(typeof e.v>"u"&&typeof e.yParity>"u")){if(e.r===void 0||e.s===void 0)throw new Error("Invalid signature provided with transaction");return{r:typeof e.r=="bigint"?e.r:b(e.r),s:typeof e.s=="bigint"?e.s:b(e.s),yParity:typeof e.v<"u"&&typeof e.yParity>"u"?I(Number(e.v)):Number(e.yParity)}}})();if(i==="eip1559"){const r=e;return R(r),vt(r,{signature:n})}if(i==="legacy"){const r=e;return K(r),Lt(r,{signature:n})}if(i==="eip2930"){const r=e;return Y(r),Pt(r,{signature:n})}if(i==="eip7702"){const r=e;return D(r),Et(r,{signature:n})}throw new Error("Invalid transaction type")}function Ut(t){if(typeof t.type<"u")return t.type;if(typeof t.authorizationList<"u")return"eip7702";if(typeof t.maxFeePerGas<"u"||typeof t.maxPriorityFeePerGas<"u")return"eip1559";if(typeof t.gasPrice<"u")return typeof t.accessList<"u"?"eip2930":"legacy";throw new Error("Invalid transaction type")}const zt="0x420000000000000000000000000000000000000F";async function Ct(t){const{transaction:e,gasPriceOracleAddress:i}=t,n=Q({client:e.client,address:i||zt,chain:e.chain}),{gasPrice:r,...o}=await X({transaction:e}),c=Tt({transaction:o});return Z({contract:n,method:"function getL1Fee(bytes memory _data) view returns (uint256)",params:[c]})}export{Ct as estimateL1Fee};
