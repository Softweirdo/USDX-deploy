import{ba as E,bb as x,bc as k}from"./Staking-BH6LCcEU.js";import"./index-Rjouby6h.js";import"./allowance-BI-KVzn1.js";import"./TypedData-NSOfGg6F.js";import"./Address-B2bsJ3eE.js";import"./arweave-CAGvOb64.js";async function F(i){var r,p;const{wallet:s,walletConnectClient:e,event:a,chains:t,onConnect:m}=i,d=s.getAccount();if(!d)throw new Error("No account connected to provided wallet");const o=(p=(r=a.verifyContext)==null?void 0:r.verified)==null?void 0:p.origin;o&&await A({origin:o,walletConnectClient:e});const n=await W({account:d,walletConnectClient:e,sessionProposal:a,chains:t});await E(n),s.subscribe("disconnect",()=>{x({session:n,walletConnectClient:e})}),m==null||m(n)}async function A({walletConnectClient:i,origin:s}){const e=await k();for(const a of e)a.origin===s&&await x({session:a,walletConnectClient:i})}async function W({account:i,walletConnectClient:s,sessionProposal:e,chains:a}){var o,n,r,p,w,f,v,l,u,g,N,h,S,b,y,$,C,q;if(!((o=e.params.requiredNamespaces)!=null&&o.eip155)&&!((n=e.params.optionalNamespaces)!=null&&n.eip155))throw new Error("No EIP155 namespace found in Wallet Connect session proposal");const t={chains:[...Array.from(new Set([...((w=(p=(r=e.params.requiredNamespaces)==null?void 0:r.eip155)==null?void 0:p.chains)==null?void 0:w.map(c=>`${c}:${i.address}`))??[],...((l=(v=(f=e.params.optionalNamespaces)==null?void 0:f.eip155)==null?void 0:v.chains)==null?void 0:l.map(c=>`${c}:${i.address}`))??[],...(a==null?void 0:a.map(c=>`eip155:${c.id}:${i.address}`))??[]]))],methods:[...((g=(u=e.params.requiredNamespaces)==null?void 0:u.eip155)==null?void 0:g.methods)??[],...((h=(N=e.params.optionalNamespaces)==null?void 0:N.eip155)==null?void 0:h.methods)??[]],events:[...((b=(S=e.params.requiredNamespaces)==null?void 0:S.eip155)==null?void 0:b.events)??[],...(($=(y=e.params.optionalNamespaces)==null?void 0:y.eip155)==null?void 0:$.events)??[]]};return{topic:(await(await s.approve({id:e.id,namespaces:{eip155:{accounts:t.chains,methods:t.methods,events:t.events}}})).acknowledged()).topic,origin:((q=(C=e.verifyContext)==null?void 0:C.verified)==null?void 0:q.origin)||"Unknown origin"}}export{W as acceptSessionProposal,A as disconnectExistingSessions,F as onSessionProposal};
