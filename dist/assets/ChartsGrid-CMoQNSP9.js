import{j as a,G as ce,b as se,r as k,c as ne,d as de,e as fe,f as ue}from"./index-DcR7dgUS.js";import{R as me,u as y,C as b,L as P,f as D,b as E}from"./LineChart-CxiqdwLb.js";function N({data:c=[],series:s=[],yAxisLabel:n,formatValue:h=o=>o.toString(),title:w}){if(!Array.isArray(c)||!Array.isArray(s)||c.length===0||s.length===0)return a.jsx("div",{className:"h-full w-full flex items-center justify-center text-gray-500",children:"No data available"});try{console.log("barData",c);const o=[...c].map(t=>({...t,date:t.date?t.date.replace(/^0(\d)\//,"$1/"):t.date}));o.sort((t,l)=>{if(!t.date||!l.date)return 0;const m=new Date(t.date).getTime(),L=new Date(l.date).getTime();return m-L});const u=o.filter(t=>t.date?s.every(l=>{const m=t[l.key];return typeof m=="number"&&!isNaN(m)&&isFinite(m)}):!1);if(u.length===0)return a.jsx("div",{className:"h-full w-full flex items-center justify-center text-gray-500",children:"Invalid data format"});const i={chart:{type:"bar",height:350,toolbar:{show:!1},animations:{enabled:!0,easing:"easeinout",speed:800,animateGradually:{enabled:!0,delay:150},dynamicAnimation:{enabled:!0,speed:350}}},plotOptions:{bar:{borderRadius:4,horizontal:!1,columnWidth:"60%"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{type:"category",categories:u.map(t=>t.date),labels:{style:{colors:"#64748b",fontSize:"12px"},trim:!0,offsetY:5,offsetX:0,rotate:-45},axisBorder:{show:!1},axisTicks:{show:!1}},yaxis:{title:{text:n,style:{color:"#64748b"}},labels:{formatter:h,style:{colors:"#64748b",fontSize:"12px"}}},fill:{opacity:1,type:"solid"},tooltip:{enabled:!0,theme:"dark",y:{formatter:h}},legend:{position:"bottom",horizontalAlign:"center",offsetY:0,labels:{colors:"#64748b"}},grid:{borderColor:"#f1f5f9",strokeDashArray:4,padding:{top:0,right:20,bottom:20,left:20}}},r=s.map(t=>({name:t.label,data:u.map(l=>{const m=Number(l[t.key]);return isNaN(m)?0:m}),color:t.color}));return a.jsx("div",{className:"h-full w-full",children:a.jsx(me,{options:i,series:r,type:"bar",height:350})})}catch(o){return console.error("Chart error:",o),a.jsx("div",{className:"h-full w-full flex items-center justify-center text-gray-500",children:"Error rendering chart"})}}function j({className:c=""}){return a.jsx("div",{className:`animate-pulse bg-gray-200 rounded ${c}`})}function oe({showLegend:c=!0}){return a.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-md",children:[a.jsx(j,{className:"h-6 w-48 mb-6"}),c&&a.jsxs("div",{className:"flex justify-end mb-4 space-x-4",children:[a.jsx(j,{className:"h-4 w-20"}),a.jsx(j,{className:"h-4 w-20"})]}),a.jsx(j,{className:"h-[200px] w-full"})]})}function he(){var u,i;const{loading:c,error:s,data:n}=y(ce);if(c&&!n)return a.jsx(oe,{});const h=((u=n==null?void 0:n.getFilteredTokenData)==null?void 0:u.map(r=>{const t={date:r==null?void 0:r.dateTime};return r.tokenBalance.forEach(l=>{t[l.tokenSymbol]=parseFloat(l.balance)}),t}))||[],o=Array.from(new Set((i=n==null?void 0:n.getFilteredTokenData)==null?void 0:i.flatMap(r=>r.tokenBalance.map(t=>t.tokenSymbol)))).map((r,t)=>({key:r,label:r,color:["#6366f1","#f59e0b","#10b981","#ec4899","#8b5cf6"][t%5]}));return a.jsx("div",{className:"transform transition-all duration-500 hover:scale-[1.02]",children:a.jsx(b,{title:"ALT Holding",children:a.jsx(P,{data:h,series:o,yAxisLabel:"Balance",formatValue:D})})})}const le=[];function ge(){var u,i;const{loading:c,error:s,data:n}=y(se),h=((u=n==null?void 0:n.getFilteredTokenData)==null?void 0:u.map(r=>{const t={date:r==null?void 0:r.dateTime};return r.tokenBalance.forEach(l=>{t[l.tokenSymbol]=parseFloat(l==null?void 0:l.updatePr).toFixed(5)}),t}))||[],o=Array.from(new Set((i=n==null?void 0:n.getFilteredTokenData)==null?void 0:i.flatMap(r=>r.tokenBalance.map(t=>t.tokenSymbol)))).map((r,t)=>({key:r,label:r,color:["#6366f1","#f59e0b","#10b981","#ec4899","#8b5cf6"][t%5]}));return console.log("alt%",h,n),a.jsx("div",{className:"transform transition-all duration-500 hover:scale-[1.02]",children:a.jsx(b,{title:"ALT Holding Profit",children:a.jsx(P,{data:h.reverse(),series:o,yAxisLabel:"Percentage",formatValue:E})})})}const xe=["#6366f1","#f59e0b","#10b981"];function ke({filterChart:c,type:s}){var B,F,G,U,C,R,X,H,O,V,$,z,K,W,M;const n=y(se),{loading:h,error:w,data:o,refetch:u}=y(ne,{variables:{type:"stack"}}),i=y(de),r=y(fe),t=y(ne,{variables:{type:"stack",tokenName:"USDX"}}),l=y(ue);if(console.log("profitData",l),k.useEffect(()=>{const e=setTimeout(()=>{},1500);return()=>clearTimeout(e)},[]),k.useEffect(()=>{const e=setInterval(()=>{},45e3);return()=>clearInterval(e)},[u]),k.useEffect(()=>{const e=setInterval(()=>{i.refetch()},45e3);return()=>clearInterval(e)},[i.refetch]),k.useEffect(()=>{const e=setInterval(()=>{r.refetch()},45e3);return()=>clearInterval(e)},[r==null?void 0:r.refetch]),k.useEffect(()=>{const e=setInterval(()=>{t.refetch()},45e3);return()=>clearInterval(e)},[t==null?void 0:t.refetch]),k.useEffect(()=>{const e=setInterval(()=>{l.refetch()},45e3);return()=>clearInterval(e)},[l==null?void 0:l.refetch]),k.useEffect(()=>{const e=setInterval(()=>{n.refetch()},45e3);return()=>clearInterval(e)},[n==null?void 0:n.refetch]),c&&le.filter(e=>e.title.toLowerCase().replace(/\s+/g,"-")===c),h&&((B=o==null?void 0:o.groupedStakingData)==null?void 0:B.length)===0)return a.jsx("div",{className:"grid grid-cols-1 gap-6",children:Array.from({length:c?2:4}).map((e,d)=>a.jsx(oe,{},d))});const m=(F=i==null?void 0:i.data)!=null&&F.dateWiseAmountByToken?i.data.dateWiseAmountByToken.map(e=>{var g;let d={date:e==null?void 0:e.date};return(g=e==null?void 0:e.tokens)==null||g.map(x=>{d[`${x.tokenName}`]=x.totalAmount}),d}):[],L=((R=(C=(U=(G=i==null?void 0:i.data)==null?void 0:G.dateWiseAmountByToken)==null?void 0:U[0])==null?void 0:C.tokens)==null?void 0:R.map((e,d)=>({key:e==null?void 0:e.tokenName,color:xe[d],label:e==null?void 0:e.tokenName})))||[],_=[],p=new Set;function I(e){const[d,g,x]=e.split("/").map(Number);return`${d}/${g}/${x}`}(H=(X=r==null?void 0:r.data)==null?void 0:X.getToken2BalanceByDate)==null||H.forEach(e=>p.add(e.date)),(V=(O=l==null?void 0:l.data)==null?void 0:O.getPercentageDifference)==null||V.forEach(e=>p.add(e.date)),(z=($=n==null?void 0:n.data)==null?void 0:$.getFilteredTokenData)==null||z.forEach(e=>{const d=I(e==null?void 0:e.dateTime);p.add(d)}),Array.from(p).sort((e,d)=>{const[g,x,A]=e.split("/").map(Number),[T,v,S]=d.split("/").map(Number);return new Date(A,g,x-1)-new Date(S,T,v-1)}).forEach(e=>{var g,x,A,T,v,S,Y,Q,q,J,Z,ee,ae,te;const d={date:e,"Trigger Peg":((A=(x=(g=r==null?void 0:r.data)==null?void 0:g.getToken2BalanceByDate)==null?void 0:x.find(f=>f.date===e))==null?void 0:A.percentage)||0,"USDX Stake":((S=(v=(T=l==null?void 0:l.data)==null?void 0:T.getPercentageDifference)==null?void 0:v.find(f=>f.date===e))==null?void 0:S.percentage)||0,"ALT Holding":(((J=(q=(Q=(Y=n==null?void 0:n.data)==null?void 0:Y.getFilteredTokenData)==null?void 0:Q.find(f=>I(f==null?void 0:f.dateTime)===e))==null?void 0:q.tokenBalance)==null?void 0:J.reduce((f,re)=>f+(Number(re.updatePr?re.updatePr:0)||0),0))/(((te=(ae=(ee=(Z=n==null?void 0:n.data)==null?void 0:Z.getFilteredTokenData)==null?void 0:ee.find(f=>I(f==null?void 0:f.dateTime)===e))==null?void 0:ae.tokenBalance)==null?void 0:te.length)||1)||0).toFixed(5)};_.push(d)});const ie=[{key:"Trigger Peg",color:"#10b981",label:"Trigger Peg"},{key:"USDX Stake",color:"#6366f1",label:"USDX Stake"},{key:"ALT Holding",color:"#f59e0b",label:"ALT Holding"}];return a.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[s==="all"&&a.jsx("div",{className:"transform transition-all duration-500 ",children:a.jsx(b,{title:"Profit Overview",children:a.jsx(P,{data:_,series:ie,yAxisLabel:"Profit Percentage",formatValue:E})})}),(s==="trigger"||s==="all")&&a.jsx("div",{className:"transform transition-all duration-500 ",children:a.jsx(b,{title:"Trigger Peg",children:a.jsx(N,{data:((K=r==null?void 0:r.data)==null?void 0:K.getToken2BalanceByDate)||[],series:[{key:"percentage",color:"#10b981",label:"USDX"}],yAxisLabel:"Profit Percentage",formatValue:E})})}),(s==="alt"||s==="all")&&a.jsx("div",{className:"transform transition-all duration-500 ",children:a.jsx(ge,{})}),s==="usdx"&&a.jsx("div",{className:"transform transition-all duration-500 ",children:a.jsx(b,{title:"USDX Stake",children:a.jsx(N,{data:((W=t==null?void 0:t.data)==null?void 0:W.groupedStakingData)||[],series:[{key:"totalAmount",color:"#6366f1",label:"USDX"}],yAxisLabel:"Amount in USDX",formatValue:D})})}),(s==="usdx"||s==="all")&&a.jsx("div",{className:"transform transition-all duration-500 ",children:a.jsx(b,{title:"USDX Stake Profit",children:a.jsx(N,{data:((M=l==null?void 0:l.data)==null?void 0:M.getPercentageDifference)||[],series:[{key:"percentage",color:"#10b981",label:"Profit Percentage"}],yAxisLabel:"Percentage",formatValue:E})})}),s==="alt"&&a.jsx("div",{className:"transform transition-all duration-500 ",children:a.jsx(he,{})}),(s==="daily"||s==="all")&&a.jsx("div",{className:"transform transition-all duration-500 ",children:a.jsx(b,{title:"Daily Stake (USD)",children:a.jsx(N,{data:(o==null?void 0:o.groupedStakingData)||[],series:[{key:"totalAmount",color:"#6366f1",label:"USD"}],yAxisLabel:"Amount in USD",formatValue:D})})}),s==="daily"&&a.jsx("div",{className:"transform transition-all duration-500 ",children:a.jsx(b,{title:"ALT Daily Stake",children:a.jsx(P,{data:m,series:L,yAxisLabel:"Amount in USD",formatValue:D})})})]})}export{ke as C};
