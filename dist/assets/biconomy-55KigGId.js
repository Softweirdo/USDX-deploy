import{bg as m}from"./Staking-CtKEBso-.js";import{a9 as c,a6 as w,aw as y,az as f}from"./index-DDnPFUOM.js";import{g as u,F as g}from"./allowance-CjB1zw19.js";import"./TypedData-CurlYljN.js";import"./Address-Dptn9wBb.js";import"./arweave-CAGvOb64.js";const d=0n;async function l({account:a,serializableTransaction:n,transaction:o,gasless:e}){const r=y({address:e.relayerForwarderAddress,chain:o.chain,client:o.client}),s=await u({contract:r,method:"function getNonce(address,uint256) view returns (uint256)",params:[a.address,d]}),i=Math.floor(Date.now()/1e3)+(e.deadlineSeconds??3600),t={from:a.address,to:n.to,token:m,txGas:n.gas,tokenGasPrice:0n,batchId:d,batchNonce:s,deadline:i,data:n.data};if(!t.to)throw new Error("Cannot send a transaction without a `to` address");if(!t.txGas)throw new Error("Cannot send a transaction without a `gas` value");if(!t.data)throw new Error("Cannot send a transaction without a `data` value");const h=g([{type:"address"},{type:"address"},{type:"address"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"bytes32"}],[t.from,t.to,t.token,t.txGas,t.tokenGasPrice,t.batchId,t.batchNonce,f(t.data)]),p=await a.signMessage({message:h});return[t,p]}async function v(a){var i;const[n,o]=await l(a),e=await fetch("https://api.biconomy.io/api/v2/meta-tx/native",{method:"POST",body:c({apiId:a.gasless.apiId,params:[n,o],from:n.from,to:n.to,gasLimit:n.txGas}),headers:{"x-api-key":a.gasless.apiKey,"Content-Type":"application/json;charset=utf-8"}});if(!e.ok)throw(i=e.body)==null||i.cancel(),new Error(`Failed to send transaction: ${await e.text()}`);const r=await e.json(),s=r.txHash;if(w(s))return{transactionHash:s,chain:a.transaction.chain,client:a.transaction.client};throw new Error(`Failed to send transaction: ${c(r)}`)}export{l as prepareBiconomyTransaction,v as relayBiconomyTransaction};
